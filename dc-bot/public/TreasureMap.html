<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>è—å¯¶åœ–è¨ˆç®—å™¨</title>
<style>
body { font-family: Arial, sans-serif; padding: 20px; }
input { width: 60px; margin: 2px; }
h3 { margin-top: 20px; }
button { margin-top: 10px; padding: 5px 10px; }
table { border-collapse: collapse; margin-top: 10px; width: 100%; max-width: 1100px; }
th, td { border: 1px solid #999; padding: 6px; text-align: center; }
th { background: #f0f0f0; }
.flex-container { display: flex; gap:20px; }
.flex-left { flex: 1; }
.flex-right { flex: 2; }
</style>
</head>
<body>

<h2>ğŸ“Š è—å¯¶åœ–è¨ˆç®—å™¨ï¼ˆå›è£œ+éš¨æ©ŸéšŠé•·ç¢ç‰‡ï¼‰</h2>
<div class="flex-container">
<div class="flex-left">

<h3>ğŸ“… æ™‚é–“</h3>
å¤©æ•¸ <input id="days" type="number" value="35">
é€±æ•¸ <input id="weeks" type="number" value="6">

<h3>ğŸ“¦ ç›®å‰ç¢ç‰‡</h3>
ç¥ <input id="f_shen" type="number" value="0">
çµ• <input id="f_jue" type="number" value="0">
ç <input id="f_zhen" type="number" value="0">
å‡¡ <input id="f_fan" type="number" value="0">

<h3>ğŸ—º å·²æœ‰è—å¯¶åœ–ï¼ˆéšŠé•·ï¼‰</h3>
ç¥ <input id="m_shen" type="number" value="0">
çµ• <input id="m_jue" type="number" value="0">
ç <input id="m_zhen" type="number" value="0">
å‡¡ <input id="m_fan" type="number" value="0">

<h3>ğŸ“œ ä»»å‹™ç¢ç‰‡</h3>
ç¥ <input id="q_shen" type="number" value="4">
çµ• <input id="q_jue" type="number" value="5">
ç <input id="q_zhen" type="number" value="9">
å‡¡ <input id="q_fan" type="number" value="8">
éš¨æ©Ÿ <input id="q_rand" type="number" value="20">

<h3>ğŸ² æ¯æ—¥éš¨æ©Ÿç¢ç‰‡</h3>
<input id="daily_rand" type="number" value="19">

<h3>âš– éš¨æ©Ÿè½‰åŒ–æ¦‚ç‡ï¼ˆç¸½å’Œ = 1ï¼‰</h3>
ç¥ <input id="p_shen" type="number" value="0.01" step="0.01">
çµ• <input id="p_jue" type="number" value="0.1" step="0.01">
ç <input id="p_zhen" type="number" value="0.2" step="0.01">
å‡¡ <input id="p_fan" type="number" value="0.69" step="0.01">

<br>
<button onclick="calc()">è¨ˆç®—</button>
</div>

<div class="flex-right">

<h3>ğŸ“ˆ æ”¶ç›Šå°ç…§è¡¨</h3>
<table>
<tr><th>å“è³ª</th><th>éšŠé•·é€šç”¨</th><th>éšŠé•·å±¬æ€§</th><th>éšŠå“¡é€šç”¨</th><th>éšŠå“¡å±¬æ€§</th></tr>
<tr><td>ç¥</td><td>40</td><td>30</td><td>20</td><td>15</td></tr>
<tr><td>çµ•</td><td>20</td><td>16</td><td>10</td><td>8</td></tr>
<tr><td>ç</td><td>10</td><td>8</td><td>5</td><td>4</td></tr>
<tr><td>å‡¡</td><td>5</td><td>4</td><td>3</td><td>2</td></tr>
</table>

<h3>ğŸ“Š è¨ˆç®—çµæœ</h3>
<div id="result"></div>

</div>
</div>

<script>
function v(id){ return Number(document.getElementById(id).value)||0; }

function calc(){
  const days=v("days"), weeks=v("weeks");

  // åŸºæœ¬ç¢ç‰‡
  let frag={
    shen:v("f_shen")+v("q_shen")+weeks*3,
    jue:v("f_jue")+v("q_jue"),
    zhen:v("f_zhen")+v("q_zhen"),
    fan:v("f_fan")+v("q_fan")
  };

  let base={
    shen:v("m_shen"),
    jue:v("m_jue"),
    zhen:v("m_zhen"),
    fan:v("m_fan")
  };

  // éšŠå“¡æ‰“åœ–æ¬¡æ•¸
  let member={
    shen:weeks*2,
    jue:days,
    zhen:days*2,
    fan:days*3
  };

  // éšŠå“¡ç¢ç‰‡åŠ å…¥
  frag.jue += member.jue;
  frag.zhen += member.zhen;
  frag.fan += member.fan;

  // éš¨æ©Ÿç¢ç‰‡è½‰åŒ–
  let totalRand=v("q_rand")+days*v("daily_rand");
  let randRemain=totalRand%10;
  let randTimes=Math.floor(totalRand/10);
  let p=[["shen",v("p_shen")],["jue",v("p_jue")],["zhen",v("p_zhen")],["fan",v("p_fan")]];
  let randConv={shen:0,jue:0,zhen:0,fan:0};
  for(let i=0;i<randTimes;i++){
    let r=Math.random(), acc=0;
    for(let [k,val] of p){
      acc+=val;
      if(r<=acc){ randConv[k]++; break; }
    }
  }

  // åˆæˆ + å›è£œ (å‡¡/ç/çµ•) éš¨æ©ŸéšŠé•·ä¹ŸåŠ å…¥ç¢ç‰‡æ± 
  let leader={}, remain={}, leaderPure={};
  ["shen","jue","zhen","fan"].forEach(t=>{
    let mg=member[t];
    let randT=randConv[t];
    let totalFrag = (t==="shen"?frag[t]:frag[t]+randT);

    if(t==="shen"){
      leaderPure[t] = Math.floor(frag[t]/10);
      remain[t] = frag[t]%10;
      leader[t] = leaderPure[t] + randT; // éš¨æ©ŸéšŠé•·åŠ ä¸Š
    } else {
      let F = totalFrag;
      let totalLeader = 0;
      while(F>=10){
        let made = Math.floor(F/10);
        totalLeader += made;
        F = F - made*10 + made;
      }
      leaderPure[t] = totalLeader;
      leader[t] = totalLeader;
      remain[t] = F;
      leader[t] += randT; // éš¨æ©ŸéšŠé•·åŠ å…¥éšŠé•·ç¸½æ•¸
    }
    base[t] += leader[t];
  });

  // æ”¶ç›Š
  const R={shen:{lg:40,la:30,mg:20,ma:15},jue:{lg:20,la:16,mg:10,ma:8},zhen:{lg:10,la:8,mg:5,ma:4},fan:{lg:5,la:4,mg:3,ma:2}};
  let sum={g:225,la:0,ma:0};

  let html=`<table>
<tr><th>å“è³ª</th><th>éšŠå“¡</th><th>éš¨æ©Ÿè½‰åŒ–</th><th>ç¢ç‰‡è½‰éšŠé•·</th><th>ç¸½æ‰“åœ–</th><th>å‰©é¤˜ç¢ç‰‡</th><th>é€šç”¨</th><th>éšŠé•·å±¬æ€§</th><th>éšŠå“¡å±¬æ€§</th></tr>`;

  ["shen","jue","zhen","fan"].forEach(t=>{
    let mg=member[t];
    let randT=randConv[t];
    let lp=leaderPure[t];
    let lg=leader[t];
    let g=lg*R[t].lg + mg*R[t].mg;
    let la=lg*R[t].la;
    let ma=mg*R[t].ma;
    sum.g+=g; sum.la+=la; sum.ma+=ma;

    html+=`<tr>
<td>${t==="shen"?"ç¥":t==="jue"?"çµ•":t==="zhen"?"ç":"å‡¡"}</td>
<td>${mg}</td>
<td>${randT}</td>
<td>${lp}</td>
<td>${lg}</td>
<td>${remain[t]}</td>
<td>${g}</td>
<td>${la}</td>
<td>${ma}</td>
</tr>`;
  });

  html+=`<tr style="font-weight:bold;background:#eee">
<td>ç¸½è¨ˆ</td><td colspan="4">éš¨æ©Ÿå‰©é¤˜ç¢ç‰‡ ${randRemain}</td>
<td>-</td>
<td>${sum.g}</td>
<td>${sum.la}</td>
<td>${sum.ma}</td>
</tr></table>`;

  document.getElementById("result").innerHTML=html;
}
</script>

</body>
</html>
